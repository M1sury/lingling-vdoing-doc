## Nacos

> 官网 Slogan ：一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。
>
> 官网链接：https://nacos.io/

对于微服务组件中的注册中心组件，在 Nacos 出来之前，就已经有很多开源组件了。比如：`Zookeeper`、`Eureka`、`Consul`等。

### 我们为什么需要注册中心？

在微服务的架构中，我们所有的服务都会按不同的粒度去拆分，原先所有功能都运行在一个服务器中，不需要考虑各个功能的通信问题。

* 单体服务：像下图所示，所有的功能都集中于一台服务器中，如果又某个功能出现了错误（比如内存溢出等），影响的是全部功能的可用性，就如同俗话说“**不能把鸡蛋放在同一个篮子里**”。但是对于一些小微公司来说，使用单体服务就已经足够正常的使用了。正所谓：最简单的架构就是最好的架构（doge）！**对于这个时代，是不需要注册中心的**。根据熟悉的`MVC`三层架构来讲，调用别的功能，就仅仅是把对方的`service`注入进来就可以，不需要考虑网络的因素。

![image-20230715210912279](http://cdn.misury.top/blog/image-20230715210912279.png)

* 微服务架构：为解决**单体服务会由于某个功能的不可用而导致所有功能的不可用**的问题。就有人提出了微服务的概念，把每个功能拆分成不同的服务，部署在不同的服务器中，就不会因为某个服务不可用，而导致全部服务不可用了。

但是，又迎来了另一个问题，每个服务之间是如何进行调用（通信）呢？

最简单的方式就是直接使用`HttpUtil`或者`RestTemplate`等工具直接发起 HTTP 请求，但是这仅仅是把每个功能拆成了一个服务。那加上**分布式**的概念呢？每个服务会部署多台机器，还能使用上述的那些工具来做吗？显然能做，但不太优雅也不好维护。

以营销服务举例，部署六个节点，其他服务来调用营销服务提供的功能，用`HttpUtil`的方式，无非是把每个营销服务节点的 IP 和 Port 写死在代码中，或许是使用权重，或许是使用随机的方式对六个节点进行调用。六个节点全部可用，这是理想的状态。

![image-20230715213732135](http://cdn.misury.top/blog/image-20230715213732135.png)

但是如果某个节点服务不可用呢？调用方又无法感知，这时候就会出现一系列问题。

如果这些服务的服务器进行一些迁移呢？IP有可能会变化。这样我们只能人工去通知各个调用方修改在代码中的 IP。

我们在现阶段的痛点无非是互相调用的服务无法知道被调用方的 IP 和 Port，以及服务节点是否正常可用。这时候就需要有一个组件来记录各个服务的基础信息（IP和Port）、心跳等信息

### 介绍

Nacos 指的是`Dynamic Naming and Configuration Service`的首字母简称，提供的服务有服务发现、服务注册、服务配置等。因为有服务配置的功能，所以不仅仅是微服务的应用可以使用，单体的项目也是可以使用的，把一些配置放在 Nacos 中，在服务不停机的情况下，可以实现配置的更新。

### 安装和启动

> 下载链接 (Linux压缩包)：https://ghproxy.com/https://github.com/alibaba/nacos/releases/download/2.0.4/nacos-server-2.0.4.tar.gz
>
> 下载链接 (Windows压缩包): https://ghproxy.com/https://github.com/alibaba/nacos/releases/download/2.0.4/nacos-server-2.0.4.zip

Nacos 的安装非常简单，下载好压缩包放到想安装的目录，解压即可

我们本次安装启动的数据源使用的是`MySQL`。

#### 修改配置文件

需要修改配置文件的一些信息。在`nacos`的`conf`目录中`application.properties`进行修改

![image-20230715215753264](http://cdn.misury.top/blog/image-20230715215753264.png)

选择数据源的平台为`MySQL`，把注释的数据源打开，填写自己的数据源信息

![image-20230715220012705](http://cdn.misury.top/blog/image-20230715220012705.png)

#### 启动

在`nacos`的`bin`目录下，`Windows`启动`start.cmd`脚本即可，`Linux`启动的是`.sh`脚本

![image-20230715220118831](http://cdn.misury.top/blog/image-20230715220118831.png)

访问 http://localhost:8848/nacos。看到这样的页面就安装成功了。登录的默认用户名密码是 nacos / nacos

![image-20230715220300180](http://cdn.misury.top/blog/image-20230715220300180.png)



## 参考

* https://nacos.io/